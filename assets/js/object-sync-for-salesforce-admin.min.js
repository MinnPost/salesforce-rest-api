!function(i){"use strict";function e(e,s){var t={action:"get_wordpress_object_description",include:["statuses","drafts"],wordpress_object:e},a=".sfwp-m-wordpress-statuses",o="#sfwp-default-status",c="",l=i(o+" option").first().text(),n="sfwp-m-wordpress-drafts",r=n+n+"-"+e+" .sfwp-m-single-checkboxes";i(a).addClass("wordpress-statuses-template"),i("."+n).addClass("sfwp-m-drafts-template"),i("."+n).addClass(n),!0===s&&i(r+' input[type="checkbox"]').prop("checked",!1),""!==i(o).val()?i(a).removeClass("wordpress-statuses-template"):c+=l='<option value="">'+l+"</option>",0<i(r+"input:checked").length&&i("."+n).removeClass("sfwp-m-drafts-template"),i.ajax({type:"POST",url:ajaxurl,data:t,beforeSend:function(){i(".spinner-wordpress").addClass("is-active")},success:function(e){0<i(e.data.statuses).length&&(i.each(e.data.statuses,function(e,s){c+='<option value="'+e+'">'+s+"</option>"}),i(o).html(c)),0<i(e.data.drafts).length&&i("."+n).removeClass("sfwp-m-drafts-template")},complete:function(){i(".spinner-wordpress").removeClass("is-active"),l!==c&&i(a).removeClass("wordpress-statuses-template")}})}function s(e,s){var t={action:"get_salesforce_object_description",include:["fields","recordTypeInfos"],field_type:"datetime",salesforce_object:e},a="sfwp-m-salesforce-record-types-allowed",o="."+a+"."+a+"-"+e+" .checkboxes",c="",l=".sfwp-m-pull-trigger-field",n="#sfwp-pull-trigger-field",r="",d=i(n+" option").first().text();i("."+a).attr("class","sfwp-m-fieldmap-subgroup "+a).addClass(a+"-"+e),i("."+a).addClass("record-types-allowed-template"),i(l).addClass("pull-trigger-field-template"),f(),!0===s?(i(o+' input[type="checkbox"]').prop("checked",!1),i(n).val(""),0<i(o+"input:checked").length&&i(a).removeClass("record-types-allowed-template")):i(a).removeClass("record-types-allowed-template"),""!==i(n).val()?i(l).removeClass("pull-trigger-field-template"):r+=d='<option value="">'+d+"</option>",i.ajax({type:"POST",url:ajaxurl,data:t,beforeSend:function(){i(".spinner-salesforce").addClass("is-active")},success:function(e){0<i(e.data.recordTypeInfos).length&&i.each(e.data.recordTypeInfos,function(e,s){c+='<label><input type="checkbox" class="form-checkbox" value="'+e+'" name="salesforce_record_types_allowed['+e+']" id="salesforce_record_types_allowed-'+e+'"> '+s+"</label>"}),i(o).html(c),0<i(e.data.fields).length&&""!==r&&(i.each(e.data.fields,function(e,s){r+='<option value="'+s.name+'">'+s.label+"</option>"}),i(n).html(r))},complete:function(){i(".spinner-salesforce").removeClass("is-active"),""!==c&&i("."+a).removeClass("record-types-allowed-template"),d!==r&&i(l).removeClass("pull-trigger-field-template")}})}function f(s){var t=i(".sfwp-m-salesforce-record-type-default"),e="#sfwp-salesforce-record-type-default",a="",o=i(e+" option").first().text(),c="";if(a+='<option value="">'+o+"</option>",0===i("."+s+' input[type="checkbox"]:checked').length)return t.addClass("record-type-default-template"),void i(e).prop("required",!1);i("."+s+' input[type="checkbox"]:checked').each(function(e){1===i("."+s+' input[type="checkbox"]:checked').length&&(c=" selected",t.addClass("record-type-default-template")),a+='<option value="'+i(this).val()+'"'+c+">"+i(this).closest("label").text()+"</option>"}),i(e).html(a),1<i("."+s+' input[type="checkbox"]:checked').length&&(t.removeClass("record-type-default-template"),i(e).prop("required",!0))}function t(t,e){var s={action:"get_"+t+"_object_fields"},a=".sfwp-fieldmap-"+t+"-field select",o="",c=i(a+" option").first().text();if(""===i(a).val()){if(o+='<option value="">'+c+"</option>","wordpress"===t)s.wordpress_object=e;else{if("salesforce"!==t)return o;s.salesforce_object=e}i.ajax({type:"POST",url:ajaxurl,data:s,beforeSend:function(){i(".spinner-"+t).addClass("is-active")},success:function(e){i.each(e.data.fields,function(e,s){"wordpress"===t?o+='<option value="'+s.key+'">'+s.key+"</option>":"salesforce"===t&&(o+='<option value="'+s.name+'">'+s.label+"</option>")}),i(a).html(o)},complete:function(){i(".spinner-"+t).removeClass("is-active")}})}}function a(){i("#add-field-mapping").click(function(){var e=i("#sfwp-salesforce-object").val(),s=i("#sfwp-wordpress-object").val(),t=(new Date).getUTCMilliseconds(),a=i("table.fields tbody tr").last(),o=a.attr("data-key");return o=new RegExp(o,"g"),i(this).text("Add another field mapping"),""!==s&&""!==e?(function(t,a,e){var s="";s=jQuery.fn.select2?e.find("select").select2("destroy").end().clone(!0).removeClass("fieldmap-template"):e.clone(!0);i(s).attr("data-key",a),i(s).each(function(){i(this).html(function(e,s){return s.replace(t,a)})}),i("table.fields tbody").append(s),jQuery.fn.select2&&(e.find("select").select2(),s.find("select").select2())}(o,t,a),i(this).parent().find(".missing-object").remove()):i(this).parent().prepend('<div class="error missing-object"><span>You have to pick a WordPress object and a Salesforce object to add field mapping.</span></div>'),!1})}function l(e,s,t){var a={action:"get_salesforce_field_info",salesforce_object:e,salesforce_field:s},o="sfwp-field-dependent-fields-template";i.ajax({type:"POST",url:ajaxurl,data:a,beforeSend:function(){i(".spinner-salesforce-field-"+t).addClass("is-active")},success:function(e){i(".sfwp-field-dependent-fields-"+t).addClass(o),""!==e.data.type&&i(".sfwp-field-dependent-fields-"+t+".sfwp-field-dependent-fields-"+e.data.type).removeClass(o)},complete:function(){i(".spinner-salesforce-field-"+t).removeClass("is-active")}})}function o(){var e={action:"refresh_mapped_data",mapping_id:i("#mapping_id_ajax").val()};i.post(ajaxurl,e,function(e){!0===e.success&&(i("td.last_sync_message").text(e.data.last_sync_message),i("td.last_sync_action").text(e.data.last_sync_action),i("td.last_sync_status").text(e.data.last_sync_status),i("td.last_sync").text(e.data.last_sync),"1"===e.data.last_sync_status&&i("td.last_sync_status").text("success"))})}function c(){0<i(".object-sync-for-salesforce-enable-soap").length&&(i(".object-sync-for-salesforce-enable-soap input").is(":checked")?i(".object-sync-for-salesforce-soap-wsdl-path").show():i(".object-sync-for-salesforce-soap-wsdl-path").hide())}i(document).on("change","select#sfwp-wordpress-object",function(){e(this.value,!0)}),i(document).ready(function(){e(i("select#sfwp-wordpress-object").val(),!1)}),i(document).on("change","select#sfwp-salesforce-object",function(){s(this.value,!0)}),i(document).on("change",'.sfwp-m-salesforce-record-types-allowed input[type="checkbox"]',function(){f("sfwp-m-salesforce-record-types-allowed")}),i(document).ready(function(){s(i("select#sfwp-salesforce-object").val(),!1)}),i(document).on("change","select#sfwp-wordpress-object",function(){var e;t("wordpress",i(this).val()),clearTimeout(e),e=setTimeout(function(){i("table.fields tbody tr").fadeOut(),i("table.fields tbody tr").not(".fieldmap-template").remove()},1e3)}),i(document).on("change","select#sfwp-salesforce-object",function(){var e;t("salesforce",i(this).val()),clearTimeout(e),e=setTimeout(function(){i("table.fields tbody tr").fadeOut(),i("table.fields tbody tr").not(".fieldmap-template").remove()},1e3)}),i(document).ready(function(){t("wordpress",i("select#sfwp-wordpress-object").val()),t("salesforce",i("select#sfwp-salesforce-object").val())}),i(document).on("change","[id^=sfwp-salesforce-field-]",function(){l(i("select#sfwp-salesforce-object").val(),i(this).val(),i(this).closest(".sfwp-a-fieldmap-values-expanded").data("key"))}),i(document).on("click",".column-is_prematch input",function(){i(".column-is_prematch input").not(this).prop("checked",!1)}),i(document).on("click",".column-is_key input",function(){i(".column-is_key input").not(this).prop("checked",!1)}),i(document).on("click",".sfwp-a-fieldmap-field-action",function(e){e.preventDefault()}),i(document).on("click",".sfwp-a-fieldmap-field-action-edit",function(e){var s=i("select#sfwp-salesforce-object").val(),t=i(this).closest(".sfwp-a-fieldmap-values"),a=t.data("key"),o=i("#sfwp-salesforce-field-"+a).val(),c="sfwp-a-fieldmap-values-expanded";!1===i(t).hasClass(c)&&l(s,o,a),t.toggleClass(c)}),i(document).on("click",".sfwp-a-fieldmap-field-action-delete",function(e){}),i(document).ready(function(){a(),jQuery.fn.select2&&(i("select#sfwp-wordpress-object").select2(),i("select#sfwp-default-status").select2(),i("select#sfwp-salesforce-object").select2(),i("select#sfwp-salesforce-record-type-default").select2(),i("select#sfwp-pull-trigger-field").select2(),i(".sfwp-fieldmap-wordpress-field select").select2(),i(".sfwp-fieldmap-salesforce-field select").select2())}),i(document).ready(function(){i("#clear-sfwp-cache").click(function(){var s=i(this);return i.post(ajaxurl,{action:"clear_sfwp_cache"},function(e){!0===e.success&&!0===e.data.success&&s.parent().html(e.data.message).fadeIn()}),!1}),i(".salesforce_user_ajax_message").hide(),0<i("#wordpress_object_ajax").length&&i(".push_to_salesforce_button").on("click",function(){var e={action:"push_to_salesforce",wordpress_object:i("#wordpress_object_ajax").val(),wordpress_id:i("#wordpress_id_ajax").val(),salesforce_id:i("#salesforce_id_ajax").val()};return i.post(ajaxurl,e,function(e){!0===e.success&&(o(),i(".salesforce_user_ajax_message").width(i(".mapped-salesforce-user").width()-27),i(".salesforce_user_ajax_message").html("<p>This object has been pushed to Salesforce.</p>").fadeIn().delay(4e3).fadeOut())}),!1}),i(".salesforce_user_ajax_message").hide(),i(".pull_from_salesforce_button").on("click",function(){var e={action:"pull_from_salesforce",salesforce_id:i("#salesforce_id_ajax").val(),wordpress_object:i("#wordpress_object_ajax").val()};return i.post(ajaxurl,e,function(e){!0===e.success&&(o(),i(".salesforce_user_ajax_message").width(i(".mapped-salesforce-user").width()-27),i(".salesforce_user_ajax_message").html("<p>This object has been pulled from Salesforce.</p>").fadeIn().delay(4e3).fadeOut())}),!1})}),i(document).on("change",".object-sync-for-salesforce-enable-soap input",function(){c()}),i(document).ready(function(){c()})}(jQuery);